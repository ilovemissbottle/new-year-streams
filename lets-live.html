<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>2026 Happy New Year</title>
    <style>
        :root {
            --neon-pink: #ff00ff;
            --neon-blue: #00f2ff;
            --bg-dark: #050505;
            --resizer-width: 4px;
        }
        body, html {
            margin: 0; padding: 0; height: 100%;
            background-color: var(--bg-dark);
            color: var(--neon-blue);
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

/* --- 左側選單：套用電視濾鏡 --- */
        .sidebar {
            position: relative; /* 為了讓特效層定位 */
            width: 15%;
            min-width: 170px;
            border-right: 1px solid var(--neon-blue);
            padding: 10px;
            display: flex;
            flex-direction: column;
            background: #0a0a0f;
            box-sizing: border-box;
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* 掃描線效果 (只在 sidebar 內) */
        .sidebar::after {
            content: " ";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 3px, 2px 100%;
            pointer-events: none; /* 確保不影響按鈕點擊 */
            z-index: 5;
        }

        /* 輕微閃爍動畫 */
        @keyframes crt-flicker {
            0% { opacity: 0.98; }
            50% { opacity: 1; }
            100% { opacity: 0.99; }
        }
        .sidebar-content {
            animation: crt-flicker 0.15s infinite;
            position: relative;
            z-index: 10;
        }

        /* 中間影片 */
        .main-stage {
            flex: 1;
            background: #000;
            overflow: hidden;
        }

        /* 右側聊天室區域 */
        .chat-panel {
            width: 15%;
            min-width: 200px;
            border-left: 1px solid var(--neon-blue);
            background: #0a0a0f;
            box-sizing: border-box;
            display: flex;
            flex-direction: column; /* 垂直排列標題與 iframe */
        }

        /* 聊天室標題標籤 */
        .chat-header {
            background: rgba(0, 242, 255, 0.1);
            border-bottom: 1px solid var(--neon-blue);
            padding: 8px 12px;
            font-size: 0.85rem;
            color: var(--neon-pink);
            text-transform: uppercase;
            letter-spacing: 1px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-shadow: 0 0 5px var(--neon-pink);
        }

        /* 拖曳條 */
        .resizer {
            width: var(--resizer-width);
            cursor: col-resize;
            background: rgba(0, 242, 255, 0.1);
            z-index: 10;
        }
        .resizer:hover { background: var(--neon-pink); }

        iframe { width: 100%; flex-grow: 1; border: none; }
        
        .dragging iframe { pointer-events: none; }

        /* 按鈕優化 */
        .nav-item { display: flex; gap: 4px; margin-bottom: 6px; }
        .nav-btn {
            flex: 1; background: transparent; border: 1px solid var(--neon-blue);
            color: var(--neon-blue); padding: 6px 10px; cursor: pointer;
            text-align: left; font-size: 0.85rem;
        }
        .nav-btn:hover { background: rgba(0, 242, 255, 0.15); }
        
        .add-btn {
            background: transparent; border: 1px solid var(--neon-pink);
            color: var(--neon-pink); padding: 6px 12px; cursor: pointer;
        }

        .multi-btn {
            background: rgba(255, 0, 255, 0.1);
            border: 1px solid var(--neon-pink);
            color: var(--neon-pink);
            padding: 4px;
            margin-bottom: 12px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .grid-mode { display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; height: 100%; gap: 4px; background: #000; }
        .status-bar { font-size: 0.7rem; margin-bottom: 8px; color: #666; }
    </style>
</head>
<body>

<div class="container" id="main-container">
    <div class="sidebar" id="left-panel">
        <div style="font-weight: bold; margin-bottom: 5px; color: var(--neon-blue);">NYE_SYSTEM</div>
        <div class="status-bar" id="status-msg">READY</div>
        <button class="multi-btn" onclick="renderMulti()">[ 啟動四格模式 ]</button>
        <div id="channel-list"></div>
    </div>

    <div class="resizer" id="resizer-1"></div>

    <div class="main-stage" id="video-container"></div>

    <div class="resizer" id="resizer-2"></div>

    <div class="chat-panel" id="right-panel-container">
        <div class="chat-header" id="chat-target-name">CHAT_FEED: NONE</div>
        <div id="chat-box" style="flex-grow: 1; display: flex; flex-direction: column;">
            </div>
    </div>
</div>

<script>
    const channelData = [
        { name: "台北 101", id: "1jnde6OlFwk" },
        { name: "台中麗寶", id: "CODQ8WHywmo" },
        { name: "高雄夢時代", id: "6nV37uSsx1o" },
        { name: "台東濱海", id: "VnZ6x6m5VAc" },
        { name: "台南晚會", id: "LvebymzFc2I" },
        { name: "新竹晚會", id: "fO69UoXVgUU" },
        { name: "雲林劍湖山", id: "AF3wC8L8NyA" }
    ];

    let selectedQueue = [];
    const getDomain = () => window.location.hostname || "localhost";

    function initMenu() {
        const list = document.getElementById('channel-list');
        channelData.forEach(ch => {
            const div = document.createElement('div');
            div.className = 'nav-item';
            div.innerHTML = `<button class="nav-btn" onclick="changeVideo('${ch.id}', '${ch.name}')">${ch.name}</button>
                             <button class="add-btn" onclick="addToQueue('${ch.id}', '${ch.name}')">+</button>`;
            list.appendChild(div);
        });
    }

    function changeVideo(id, name) {
        // 更新主畫面
        document.getElementById('video-container').innerHTML = 
            `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1&mute=1" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
        
        // 更新聊天室與標題
        updateChat(id, name);
        
        document.getElementById('status-msg').innerText = "TRACKING: " + id;
    }

    function updateChat(id, name) {
        document.getElementById('chat-target-name').innerText = "CHAT_FEED: " + name;
        document.getElementById('chat-box').innerHTML = 
            `<iframe src="https://www.youtube.com/live_chat?v=${id}&embed_domain=${getDomain()}"></iframe>`;
    }

    function addToQueue(id, name) {
        if (selectedQueue.some(item => item.id === id)) return;
        if (selectedQueue.length >= 4) selectedQueue.shift();
        selectedQueue.push({id, name});
        document.getElementById('status-msg').innerText = `QUEUE: ${selectedQueue.length}/4`;
    }

    function renderMulti() {
        if (selectedQueue.length === 0) { alert("請先點擊頻道旁邊的 [+]"); return; }
        
        // 渲染影片
        let html = '<div class="grid-mode">';
        selectedQueue.forEach(item => {
            html += `<iframe src="https://www.youtube.com/embed/${item.id}?autoplay=1&mute=1" allow="autoplay" allowfullscreen></iframe>`;
        });
        html += '</div>';
        document.getElementById('video-container').innerHTML = html;
        
        // 四格模式下，聊天室預設顯示清單最後加入的那個
        const lastItem = selectedQueue[selectedQueue.length - 1];
        updateChat(lastItem.id, lastItem.name + " (MULTI)");
        
        document.getElementById('status-msg').innerText = "MULTI_VIEW";
    }

    // 拖曳邏輯保持不變
    function setupResizers() {
        const container = document.getElementById('main-container');
        const leftPanel = document.getElementById('left-panel');
        const rightPanel = document.getElementById('right-panel-container');
        const r1 = document.getElementById('resizer-1');
        const r2 = document.getElementById('resizer-2');

        const attachResizer = (resizer, panel, isLeft) => {
            resizer.addEventListener('mousedown', (e) => {
                const startX = e.clientX;
                const startWidth = panel.offsetWidth;
                container.classList.add('dragging');
                const moveHandler = (moveE) => {
                    const diff = isLeft ? (moveE.clientX - startX) : (startX - moveE.clientX);
                    panel.style.width = (startWidth + diff) + 'px';
                };
                const upHandler = () => {
                    container.classList.remove('dragging');
                    document.removeEventListener('mousemove', moveHandler);
                    document.removeEventListener('mouseup', upHandler);
                };
                document.addEventListener('mousemove', moveHandler);
                document.addEventListener('mouseup', upHandler);
            });
        };
        attachResizer(r1, leftPanel, true);
        attachResizer(r2, rightPanel, false);
    }

    window.onload = () => {
        initMenu();
        setupResizers();
        changeVideo(channelData[0].id, channelData[0].name);
    };
</script>
</body>
</html>
