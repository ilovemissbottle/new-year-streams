<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>2026 CYBER NYE COMMAND CENTER</title>
    <style>
        :root {
            --neon-pink: #ff00ff;
            --neon-blue: #00f2ff;
            --bg-dark: #050505;
            --resizer-width: 4px;
        }
        body, html {
            margin: 0; padding: 0; height: 100%;
            background-color: var(--bg-dark);
            color: var(--neon-blue);
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            overflow: hidden;
        }

        /* 移除所有掃描線效果，保持背景乾淨 */
        .container {
            display: flex;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        /* 左側選單 */
        .sidebar {
            width: 15%;
            min-width: 150px;
            border-right: 1px solid var(--neon-blue);
            padding: 10px;
            display: flex;
            flex-direction: column;
            background: #0a0a0f;
            box-sizing: border-box;
            overflow-y: auto;
        }

        /* 中間影片 */
        .main-stage {
            flex: 1;
            background: #000;
            overflow: hidden;
        }

        /* 右側聊天室 */
        .chat-panel {
            width: 15%;
            min-width: 200px;
            border-left: 1px solid var(--neon-blue);
            background: #0a0a0f;
            box-sizing: border-box;
        }

        /* 拖曳條 */
        .resizer {
            width: var(--resizer-width);
            cursor: col-resize;
            background: rgba(0, 242, 255, 0.1);
            transition: background 0.2s;
            z-index: 10;
        }
        .resizer:hover { background: var(--neon-pink); }

        iframe { width: 100%; height: 100%; border: none; }
        
        /* 拖曳保護層 */
        .dragging iframe { pointer-events: none; }

        /* 按鈕樣式優化 */
        .nav-item { display: flex; gap: 4px; margin-bottom: 6px; }
        .nav-btn {
            flex: 1; background: transparent; border: 1px solid var(--neon-blue);
            color: var(--neon-blue); padding: 6px 10px; cursor: pointer;
            text-align: left; font-size: 0.85rem; overflow: hidden; white-space: nowrap;
        }
        .nav-btn:hover { background: rgba(0, 242, 255, 0.15); }
        
        .add-btn {
            background: transparent; border: 1px solid var(--neon-pink);
            color: var(--neon-pink); padding: 6px 12px; cursor: pointer;
        }

        /* 縮小高度的四格按鈕 */
        .multi-btn {
            background: rgba(255, 0, 255, 0.1);
            border: 1px solid var(--neon-pink);
            color: var(--neon-pink);
            padding: 4px; /* 縮小高度 */
            margin-bottom: 12px;
            cursor: pointer;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .multi-btn:hover { background: var(--neon-pink); color: #000; }

        .grid-mode { display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; height: 100%; gap: 4px; background: #000; }
        .status-bar { font-size: 0.7rem; margin-bottom: 8px; color: #666; }
    </style>
</head>
<body>

<div class="container" id="main-container">
    <div class="sidebar" id="left-panel">
        <div style="font-weight: bold; margin-bottom: 5px; color: var(--neon-blue);">NYE_SYSTEM</div>
        <div class="status-bar" id="status-msg">READY</div>
        
        <button class="multi-btn" onclick="renderMulti()">[ 啟動四格模式 ]</button>
        
        <div id="channel-list"></div>
    </div>

    <div class="resizer" id="resizer-1"></div>

    <div class="main-stage" id="video-container">
        </div>

    <div class="resizer" id="resizer-2"></div>

    <div class="chat-panel" id="right-panel">
        </div>
</div>

<script>
    const channelData = [
        { name: "台北 101", id: "1jnde6OlFwk" },
        { name: "台中麗寶", id: "CODQ8WHywmo" },
        { name: "高雄夢時代", id: "6nV37uSsx1o" },
        { name: "台東濱海", id: "VnZ6x6m5VAc" },
        { name: "台南晚會", id: "LvebymzFc2I" },
        { name: "新竹晚會", id: "fO69UoXVgUU" },
        { name: "雲林劍湖山", id: "AF3wC8L8NyA" }
    ];

    let selectedQueue = [];

    // 取得當前網址，用於 YouTube 留言板嵌入權限
    function getDomain() {
        return window.location.hostname || "localhost";
    }

    function initMenu() {
        const list = document.getElementById('channel-list');
        channelData.forEach(ch => {
            const div = document.createElement('div');
            div.className = 'nav-item';
            div.innerHTML = `<button class="nav-btn" onclick="changeVideo('${ch.id}')">${ch.name}</button>
                             <button class="add-btn" onclick="addToQueue('${ch.id}')">+</button>`;
            list.appendChild(div);
        });
    }

    function changeVideo(id) {
        // 主畫面切換 (靜音自動播放以符合瀏覽器政策)
        document.getElementById('video-container').innerHTML = 
            `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1&mute=1" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
        
        // 留言板切換 - 加入更多參數確保載入
        const domain = getDomain();
        document.getElementById('right-panel').innerHTML = 
            `<iframe src="https://www.youtube.com/live_chat?v=${id}&embed_domain=${domain}" id="chat-iframe"></iframe>`;
        
        document.getElementById('status-msg').innerText = "TRACKING: " + id;
    }

    function addToQueue(id) {
        if (selectedQueue.includes(id)) return;
        if (selectedQueue.length >= 4) selectedQueue.shift();
        selectedQueue.push(id);
        document.getElementById('status-msg').innerText = `QUEUE: ${selectedQueue.length}/4`;
    }

    function renderMulti() {
        if (selectedQueue.length === 0) { alert("請先點擊頻道旁邊的 [+]"); return; }
        let html = '<div class="grid-mode">';
        selectedQueue.forEach(id => {
            html += `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1&mute=1" allow="autoplay" allowfullscreen></iframe>`;
        });
        html += '</div>';
        document.getElementById('video-container').innerHTML = html;
        document.getElementById('status-msg').innerText = "MULTI_VIEW";
    }

    // 拖曳縮放邏輯
    function setupResizers() {
        const container = document.getElementById('main-container');
        const leftPanel = document.getElementById('left-panel');
        const rightPanel = document.getElementById('right-panel');
        const r1 = document.getElementById('resizer-1');
        const r2 = document.getElementById('resizer-2');

        const attachResizer = (resizer, panel, isLeft) => {
            resizer.addEventListener('mousedown', (e) => {
                const startX = e.clientX;
                const startWidth = panel.offsetWidth;
                container.classList.add('dragging');

                const moveHandler = (moveE) => {
                    const diff = isLeft ? (moveE.clientX - startX) : (startX
